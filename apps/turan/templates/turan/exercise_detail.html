{% extends "turan/event_detail.html" %}
{% load i18n %}
{% load turan_extras %}
{% block title %}
{{block.super}}
{{ object }}, {{ object.date }}
{% endblock %}
{% block extra_head %}
{{ block.super }}
    <script type="text/javascript" src="{{MEDIA_URL}}turan/flot/jquery.flot.crosshair.js"></script>
{% endblock %}
{% block extramenu %}
{{ block.super }}
{% ifequal user object.user %}
        {% if object.sensor_file %}
        <li class="modify"><a href="{% url exercise_parse object.id %}">
        <img alt="modify" title="{% trans "Reparse exercise" %}" src="{{ "page_refresh"|silk_icon }}">
         {% trans "Reparse" %}</a></li>
        {% endif %}
        <li class="modify">
        <a href="{% url exercise_update object.id %}">
        <img alt="modify" title="{% trans "Modify exercise" %}" src="{{ "wrench"|silk_icon }}"> {% trans "Modify" %}
        </a>
        </li>
        <li class="modify delete"><a href="{% url exercise_delete object.id %}">
        <img alt="delete" title="{% trans "Delete exercise" %}" src="{{ "cross"|silk_icon }}"> {% trans "Delete" %}
        </a></li>
{% else %}
{% if user.is_superuser %}
        {% if object.sensor_file %}
            <li class="modify"><a href="{% url exercise_parse object.id %}">
            <img alt="modify" title="{% trans "Reparse exercise" %}" src="{{ "page_refresh"|silk_icon }}">
             {% trans "Reparse" %}</a></li>
        {% endif %}
{% endif %}
{% endifequal %}
{% endblock%}
{% block graph %}
{% ifnotequal object.exercisedetail_set.count 0 %}
<div id="tabs">
    <ul>
        <li class="selected" id="tabs-select-1"><p><img alt="Graph" src="{{MEDIA_URL}}pinax/img/silk/icons/chart_curve.png">{% trans "Graph" %}</p></li>
        <li id="tabs-select-2"><p>{% trans "Comments" %}</p></li>
        {% if intervals %}
        <li id="tabs-select-3"><p>{% trans "Intervals" %}</p></li>
        {% endif %}
        <li id="tabs-select-4"><p>{% trans "Zones" %}</p></li>
        <li id="tabs-select-5"><p>{% trans "Freqs" %}</p></li>
        {% ifequal object.exercise_type.slopes 1 %}
            {% if slopes %}
        <li id="tabs-select-6"><p>{% trans "Slopes" %}</p></li>
            {% endif %}
        {% endifequal %}
        {% ifequal object.exercise_type.altitude 1 %}
        <li id="tabs-select-7"><p>{% trans "Inclinedata" %}</p></li>
        {% endifequal %}
        <li id="tabs-select-9"><p>{% trans "Best Efforts" %}</p></li>
        </ul>
    <div id="tabs-1" class="graph visible">
        {% include "turan/exercise/graph.html" %}
    </div>
    <div id="tabs-2">
        {% if object.comment %}
        <li class="comment">{{ object.user }} {% trans "writes" %}:
            <p>{{ object.comment|linebreaks }}</p>
        </li>
    {% endif %}
            {% include "turan/commentform.html" %}
    </div>
    {% if intervals %}
    <div id="tabs-3" class="interval_tab">
        {% include "turan/exercise/interval_tab.html" %}
    </div>
    {% endif %}
    <div id="tabs-4" class="zone_tab">
        {% include "turan/exercise/zone_tab.html" %}
    </div>
    <div id="tabs-5" class="hrhzone_tab">
        {% include "turan/exercise/hrhzone_tab.html" %}
    </div>
    {% ifequal object.exercise_type.slopes 1 %}
    {% if slopes %}
        {% include "turan/exercise/slope_tab.html" %}
    {% endif %}
    {% endifequal %}
    {% ifequal object.exercise_type.altitude 1 %}
    <div id="tabs-7">
        <div id="gradientzonediv" style="width:900px;height:400px; float: right;"></div>
        <div id="gradientzonetable" style="width:1px; height: 400px;"></div>
        {% include "turan/exercise/gradient_tab.html" %}
        {% include "turan/exercise/incline_tab.html" %}
    </div>
    {% endifequal %}
    <div id="tabs-9">
        {% include "turan/exercise/best_effort_tab.html" %}
    </div>
</div>
<script type="text/javascript">
    function selectTab(evt) {
        var id = evt.target.id ? evt.target.id : evt.target.parentNode.id;
        id = "tabs-" + id.split('-')[2];
        $('#tabs div.visible').removeClass('visible');
        $('#tabs div#' + id).addClass('visible');
        $('#tabs>ul>li').removeClass('selected');
        $(this).addClass('selected');
        window.location.hash = $(this).attr("id");
    }
    $('#tabs>ul>li').each(function () {
        $(this).bind("click", selectTab);
    });
    $('.zoom-select').each(function () {
        $(this).bind("click", selectTab);
    });
    $(window).bind("hashchange", function (evt) {
        $(window.location.hash).trigger("click");
    });
    $(window).trigger("hashchange");

    var commentcount = $('.bulk').size();
    {% if object.comment %}
    commentcount += 1;
    {% endif %}
    $('#tabs-select-2').html('<p>{% trans "Comments" %} (' + commentcount + ')</p>');


</script>
{% endifnotequal %}
{% endblock %}
