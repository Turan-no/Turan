{% load i18n %}
<a href="#" title="{% trans "Zoom out" %}" id="reset_zoom" >
    <img style="float: right" src="{{ MEDIA_URL }}pinax/img/silk/icons/zoom_out.png" /> 
</a>
<a href="#" title="{% trans "Enlarge" %}" id="enlarge" >
    <img style="float: right" src="{{ MEDIA_URL }}pinax/img/silk/icons/zoom_in.png" /> 
</a>
<a href="{% url segmentdetail_create %}?exercise={{object.id }}" title="{% trans "Add segment for this selection" %}" class="hidden" id="segment_add" >
    <img id="segment_add_img" style="float: right" src="{{ MEDIA_URL }}pinax/img/silk/icons/world_add.png" /> 
</a>
<div id="tripdiv_legend" style="float:right; margin-right: 40px"></div>
<hr class="clear" />

<div id="scrollhacks">
    <div id="tripdiv" style="width:980px;height:500px; background: white;">
        <div align="center">
            <h2>{% trans "Loading graph" %}...</h2>
            <br />
            <img alt="spinner" src="{{MEDIA_URL}}turan/cyclist.gif">
        </div>
    </div>
</div>
<div class="averages" id="averages">
    <ul>
        <!-- Restructure as needed data appears in spans automagic -->
        <li class="hidden duration"><span class="data duration"></span> s</li>
        <li class="hidden distance"><span class="data distance"></span> m</li>
        <li class="hidden ascent"><span class="data ascent"></span> m</li>
        <li class="hidden decent"><span class="data descent"></span> m</li>
        <li class="hidden hr"><span class="data hr__min"></span>  {% trans "BPM" %}</li>
        <li class="hidden hr"><span class="data hr__max"></span>  {% trans "BPM" %}</li>
        <li class="hidden hr"><span class="data hr__avg"></span>  {% trans "BPM" %}</li>
        <li class="hidden gradient"><span class="data gradient"></span> deg</li>
        <li class="hidden vam"><span class="data vam"></span> VAM</li>
        <li class="hidden speed"><span class="data speed__min"></span> {% trans "km/h" %}</li>
        <li class="hidden speed"><span class="data speed__max"></span> {% trans "km/h" %}</li>
        <li class="hidden speed"><span class="data speed__avg"></span> {% trans "km/h" %}</li>
        <li class="hidden cadence"><span class="data cadence__min"></span> {% trans "RPM" %}</li>
        <li class="hidden cadence"><span class="data cadence__max"></span> {% trans "RPM" %}</li>
        <li class="hidden cadence"><span class="data cadence__avg"></span> {% trans "RPM" %}</li>
        <li class="hidden power"><span class="data power__min"></span> W</li>
        <li class="hidden power"><span class="data power__max"></span> W</li>
        <li class="hidden power"><span class="data power__avg"></span> W</li>
        <li class="hidden power"><span class="data power__normalized"></span> W</li>
        <li class="hidden power"><span class="data power__avg_est"></span> W</li>
        <li class="hidden temp"><span class="data temp__min"></span> ℃</li>
        <li class="hidden temp"><span class="data temp__max"></span> ℃</li>
        <li class="hidden temp"><span class="data temp__avg"></span> ℃</li>
        <li class="hidden temp"><span class="data temp__avg_est"></span> ℃</li>
    </ul>
    <p style="float: right;" id="choices">{% trans "Graph" %}:</p>
    <hr class="clear" />
</div>
<script id="source" type="text/javascript" src="{{ MEDIA_URL }}turan/graphplotter.js"></script>
<script type="text/javascript">
    {% if lonlats %}
    var route_coordinates = {{lonlats}};
    {% else %}
    var route_coordinates = [];
    {% endif %}

    var route_points = [];

    var markings = [];

    {% if intervals %}
    {% for interval in intervals %}
        {% if forloop.counter0 %}
        {% if time_xaxis %}
        markings.push( { xaxis: { from: {{interval.get_relative_time_in_minutes}}, to: {{interval.get_relative_time_in_minutes}} }, color:  "#cccccc" });
        {% else %}
        {% if interval.start %}
        markings.push( { xaxis: { from: {{interval.start}}/1000, to: {{interval.start}}/1000 }, color:  "#cccccc" });
        {% endif %}
        {% endif %}
        {% endif %}
    {% endfor %}
    {% endif %}

    $(document).ready(function () {
        // Get datasets from json
        $.getJSON("{% url json_trip_series object.id %}?smooth={{smooth}}", function (datasets) {
            GraphPlotter.init({
                datasets: datasets,
                backendUrl: "{% url powerjson object.id %}",
                max_hr: {{ max_hr }},
                markings: markings,
                xaxisformatter: {% if time_xaxis %}"time"{%else%}"length"{%endif%}
            });
            var orly = window.location.hash.split('-')
            if (orly) {
                if (orly[0] == "#graph") {
                    var x = orly[2];
                    var x2 = orly[3];
                    GraphPlotter.plotAccordingToChoices({});
                    GraphPlotter.plotAccordingToChoices({ xaxis: { from: x, to: x2 }});
                }
                else {
                    GraphPlotter.plotAccordingToChoices({});
                }
            }
        });
    });
</script>
