{% load i18n %}
<a href="#" title="{% trans "Zoom out" %}" id="reset_zoom" >
    <img style="float: right" src="{{ MEDIA_URL }}pinax/images/silk/icons/zoom_out.png" />
</a>
<div id="tripdiv_legend" style="width:450px;float:right"></div>
<hr class="clear" />
<div id="tripdiv" style="width:980px;height:500px; background: white;"></div>
<div class="averages" id="averages">
    <ul>
        <!-- Restructure as needed data appears in spans automagic -->
        <li class="hidden duration"><span class="data duration"></span> s</li>
        <li class="hidden distance"><span class="data distance"></span> m</li>
        <li class="hidden ascent"><span class="data ascent"></span> m</li>
        <li class="hidden decent"><span class="data descent"></span> m</li>
        <li class="hidden hr"><span class="data hr__min"></span>  {% trans "BPM" %}</li>
        <li class="hidden hr"><span class="data hr__max"></span>  {% trans "BPM" %}</li>
        <li class="hidden hr"><span class="data hr__avg"></span>  {% trans "BPM" %}</li>
        <li class="hidden gradient"><span class="data gradient"></span> deg</li>
        <li class="hidden speed"><span class="data speed__min"></span> {% trans "km/h" %}</li>
        <li class="hidden speed"><span class="data speed__max"></span> {% trans "km/h" %}</li>
        <li class="hidden speed"><span class="data speed__avg"></span> {% trans "km/h" %}</li>
        <li class="hidden cadence"><span class="data cadence__min"></span> {% trans "RPM" %}</li>
        <li class="hidden cadence"><span class="data cadence__max"></span> {% trans "RPM" %}</li>
        <li class="hidden cadence"><span class="data cadence__avg"></span> {% trans "RPM" %}</li>
        <li class="hidden power"><span class="data power__min"></span> W</li>
        <li class="hidden power"><span class="data power__max"></span> W</li>
        <li class="hidden power"><span class="data power__avg"></span> W</li>
        <li class="hidden power"><span class="data power__avg_est"></span> W</li>
    </ul>
    <p style="float: right;" id="choices">{% trans "Graph" %}:</p>
    <hr class="clear" />
</div>
<script id="source" type="text/javascript" src="{{ MEDIA_URL }}turan/graphplotter.js"></script>
<script type="text/javascript">
    function evaluate(y,threshold) { 
        return y < threshold;
    }
    var constraint0 = {
        threshold: {{ max_hr }}*0.6,
        color: "rgb(240,240,240)",
        evaluate : evaluate
    }
    var constraint1 = {
        threshold: {{ max_hr }}*0.72,
        color: "rgb(204,204,204)",
        evaluate : evaluate
    }
    var constraint2 = {
        threshold: {{ max_hr }}*0.82,
        color: "rgb(51,102,255)",
        evaluate : evaluate
    }
    var constraint3 = {
        threshold: {{ max_hr }}*0.87,
        color: "rgb(102,204,0)",
        evaluate : evaluate
    }
    var constraint4 = {
        threshold: {{ max_hr }}*0.92,
        color: "rgb(255,153,0)",
        evaluate : evaluate
    }
    var constraint5 = {
        threshold: {{ max_hr }}*0.97,
        color: "rgb(255,0,0)",
        evaluate : evaluate
    }
    var route_coordinates = [{% for lonlat in lonlats %}{% if lonlat.0 %}[{{lonlat.0}},{{lonlat.1}}]{% if forloop.last%}{%else%},{%endif%} {%endif%}{% endfor %}];
    var route_points = [];
    datasets = {{ datasets }};
    GraphPlotter.init({
        datasets: datasets, 
        backendUrl: "{% url powerjson object.id %}",
        max_hr: {{ max_hr }},
        xaxisformatter: {% if time_xaxis %}"time"{%else%}"length"{%endif%}
    });
</script>

